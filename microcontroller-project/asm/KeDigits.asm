$include (C8051F310.INC)
$include (GlobalVars.inc)



PUBLIC	KeDigits_Init
PUBLIC	KeDigits_Output


KEDIGITS	SEGMENT		CODE
			RSEG		KEDIGITS



KeDigits_Init:
		PUSH	08H
		JB		INIT_KeDigits,FinishInit
		SETB	INIT_KeDigits
		
		MOV		08H,#11000000B
		ACALL	KeDigits_Output
		
FinishInit:
		POP		08H
		RET
		
		


;08H.7 08H.6  00normal  01dp  10 light  11 close
;08h.5 08H.4  00  First  01 second 10 third 11 fourth
;08L   00~09: num0~9   10: -
KeDigits_Output:	
		PUSH	00H
		PUSH	01H
		MOV		R1,#00H
		MOV		R0,#00H
		MOV		A,08H
		MOV		R0,A
		MOV		C,ACC.4
		MOV		P0.6,C
		MOV		C,ACC.5
		MOV		P0.7,C
		ANL		A,#11000000B
		CJNE	A,#00000000B,MODE0
		LJMP	OUTPUT
MODE0:	CJNE	A,#01000000B,MODE1
		MOV		R1,#01
		LJMP	OUTPUT
MODE1:	CJNE	A,#10000000B,MODE2
		MOV		P1,#0FFH
		RET
MODE2:	CJNE	A,#11000000B,MODE3
		MOV		P1,#00H
MODE3:	LJMP	BACK2
OUTPUT:	MOV		A,R0
		ANL		A,#00001111B
		CJNE	A,#00000000B,OUTPUT1
		MOV		A,#11111100B
		MOV		P1,A
		MOV		A,R1
		JNZ		DPPP
		LJMP	BACK2
DPPP:	LJMP	DPPPP		
OUTPUT1:CJNE	A,#00000001B,OUTPUT2
		MOV		A,#01100000B
		MOV		P1,A
		MOV		A,R1
		JNZ		DPPPP
		LJMP	BACK2
OUTPUT2:CJNE	A,#00000010B,OUTPUT3
		MOV		A,#11011010B
		MOV		P1,A
		MOV		A,R1
		JNZ		DPPPP
		LJMP	BACK2
OUTPUT3:CJNE	A,#00000011B,OUTPUT4
		MOV		A,#11110010B
		MOV		P1,A
		MOV		A,R1
		JNZ		DPPPP
		LJMP	BACK2
OUTPUT4:CJNE	A,#00000100B,OUTPUT5
		MOV		A,#01100110B
		MOV		P1,A
		MOV		A,R1
		JNZ		DPPPP
		LJMP	BACK2
OUTPUT5:CJNE	A,#00000101B,OUTPUT6
		MOV		A,#10110110B
		MOV		P1,A
		MOV		A,R1
		JNZ		DPPPP
		LJMP	BACK2
OUTPUT6:CJNE	A,#00000110B,OUTPUT7
		MOV		A,#10111110B
		MOV		P1,A
		MOV		A,R1
		JNZ		DPPPP
		LJMP	BACK2
OUTPUT7:CJNE	A,#00000111B,OUTPUT8
		MOV		A,#11100000B
		MOV		P1,A
		MOV		A,R1
		JNZ		DPPPP
		LJMP	BACK2
OUTPUT8:CJNE	A,#00001000B,OUTPUT9
		MOV		A,#11111110B
		MOV		P1,A
		MOV		A,R1
		JNZ		DPPPP
		LJMP	BACK2
OUTPUT9:
		CJNE	A,#00001001B,OUTPUT10
		MOV		A,#11110110B
		MOV		P1,A
		MOV		A,R1
		JNZ		DPPPP
		LJMP	BACK2
OUTPUT10:
		MOV		A,#00000010B
		MOV		P1,A
		MOV		A,R1
		JNZ		DPPPP
		LJMP	BACK2
DPPPP:	
		INC		P1
		
BACK2:	POP		01H
		POP		00H
		RET
		
		
		
		
		
		
		
		
		END